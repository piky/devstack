{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3330fb92_3efe07fe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 22873
      },
      "writtenOn": "2023-04-26T07:35:22Z",
      "side": 1,
      "message": "recheck one of the tests in a grenade multinode job timeouted out",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "16fce1e3_6322b763",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 8313
      },
      "writtenOn": "2023-04-26T07:51:03Z",
      "side": 1,
      "message": "recheck\ngrenade hit https://bugs.launchpad.net/neutron/+bug/2015065",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a15e71c6_98351fa0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 13252
      },
      "writtenOn": "2023-04-26T09:55:18Z",
      "side": 1,
      "message": "-1 just for the wrong version being checked",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5d752b11_f1a91218",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 522,
      "author": {
        "id": 13252
      },
      "writtenOn": "2023-04-26T09:55:18Z",
      "side": 1,
      "message": "actually that\u0027s since 0.6.0",
      "range": {
        "startLine": 522,
        "startChar": 20,
        "endLine": 522,
        "endChar": 25
      },
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f632b9f5_69fe8c0a",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 522,
      "author": {
        "id": 22873
      },
      "writtenOn": "2023-04-26T12:10:10Z",
      "side": 1,
      "message": "right, thanks, i\u0027ll fix that in a new patch set",
      "parentUuid": "5d752b11_f1a91218",
      "range": {
        "startLine": 522,
        "startChar": 20,
        "endLine": 522,
        "endChar": 25
      },
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "605d3e10_a8b14b98",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 13252
      },
      "writtenOn": "2023-04-26T09:55:18Z",
      "side": 1,
      "message": "I\u0027m not sure if we can stick with this as \"good enough for now\", but it is possible to override DEFAULT_IMAGE_FILE_NAME to be not derived from CIRROS_VERSION. so at least a warning note might be good, if not using SCENARIO_IMAGE_FILE to extract the version directly. otoh the image file name may not contain a version at all, so this all is pretty fragile, in the end tempest should autodetect the correct client. or just work with dhcp and not need to do such hacky things at all.",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7b611de2_fcc2d980",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 22873
      },
      "writtenOn": "2023-04-26T12:10:10Z",
      "side": 1,
      "message": "it works - https://review.opendev.org/c/openstack/tempest/+/881536 - the problem we had before with one of the scenario test in tempest-slow jobs and tempest-full-py3 is solved (https://bugs.launchpad.net/tempest/+bug/2007973)\n\nDEFAULT_IMAGE_FILE_NAME not being derived from CIRROS_VERSION is a good point, i considered that, but the alternative would be to check the version directly from SCENARIO_IMAGE_FILE or DEFAULT_IMAGE_FILE_NAME which is a bit worse, as the name doesn\u0027t have to contain the version at all.\nAnyway, this file generates tempest.conf based on what\u0027s being deployed, if a user overrides the image and doesn\u0027t set the CIRROS_VERSION (well, they don\u0027t have to, e.g. if they use a non cirros image) and the image uses a different dhcp client than tempest expects by default, deployment will still work, they\u0027ll just need to modify the tempest.conf before running tempest - as matter of fact any user should verify whether tempest.conf contains the config they intend to run with.\n\ntempest can\u0027t detect the client, tempest doesn\u0027t do any kind of detection, it\u0027s always up to a user what config (tempest.conf) is tempest gonna be executed with - this way we avoid f.e. any unintended skips",
      "parentUuid": "605d3e10_a8b14b98",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "90602323_8d101fba",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 8556
      },
      "writtenOn": "2023-05-16T01:21:12Z",
      "side": 1,
      "message": "I agree with frickler, this solution is more fragile.\n\nIf we are bumping default image version to 0.6.1 then let\u0027s change the default in tempest also to dhcpcd and stable branch which still use tempest can set it to udhcpc This way at least we will be up to dated from current master onwards.\n\nInstead of auto fetching the version from image file name. let\u0027s hard code it as per known image version used in devstack with a note that if cirros is \u003c0.6.0 thgen use udhcpc otherwise dhcpcd",
      "parentUuid": "7b611de2_fcc2d980",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e23b7e8b_e60c0ff0",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 8556
      },
      "writtenOn": "2023-05-16T01:32:44Z",
      "side": 1,
      "message": "or if we want to be more careful about other images and not to change the default dhcp_client for them then let\u0027s keep dhcp_client default as it is today and add a new config option in tempest something \u0027img_file_type\u0027 with default to \u0027cirros\u0027 which is what our CI tests. And based on that img_file_type and CIRROS_VERSION  we can set the dhcp_client here (then it will not need change in devstack stable branches).\n\nAny job or downstream using other than Cirros image can set img_file_type to other value so that they get it what tempest default is.",
      "parentUuid": "90602323_8d101fba",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e58a1450_5c7229cc",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 22873
      },
      "writtenOn": "2023-05-16T16:37:07Z",
      "side": 1,
      "message": "changing default value in tempest might get us into trouble too, depending on how many consumers rely on the current value\n\n-- 1 -- \n1. patch to devstack master and stable branches to explicitly set the tempest\u0027s current dhcp_client value.\n2. patch to tempest to change the default to dhcpcd\n3. patch to devstack master to use cirros 0.6.1 (and set dhcp_client to dhcpcd, or drop the hardcoding of the value as it\u0027s a new default in tempest)\n\nIn this approach, CI is fine, however, any consumer who implicitly relied on the old tempest\u0027s default will start failing - it\u0027s hard to predict how many affected consumers there would be\n\n-- 2 --\nthis is what you\u0027re proposing in the second comment, although, I\u0027m not fully following that - we can\u0027t use tempest\u0027s option to set another one - therefore I don\u0027t see how img_file_type, a new option in tempest, would help us. We could add a new option, IMG_FILE_TYPE, to devstack and use that with CIRROS_VERSION to set udhcpc or dhcpcd.\nIs that what you meant? \n\nThe second approach is easier than the first one, a single patch and no defaults are changed.",
      "parentUuid": "e23b7e8b_e60c0ff0",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0a48556_77a835d0",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 8556
      },
      "writtenOn": "2023-05-17T01:01:16Z",
      "side": 1,
      "message": "\u003e -- 2 --\n\u003e this is what you\u0027re proposing in the second comment, although, I\u0027m not fully following that - we can\u0027t use tempest\u0027s option to set another one - therefore I don\u0027t see how img_file_type, a new option in tempest, would help us. We could add a new option, IMG_FILE_TYPE, to devstack and use that with CIRROS_VERSION to set udhcpc or dhcpcd.\n\u003e Is that what you meant? \n\u003e \n\u003e The second approach is easier than the first one, a single patch and no defaults are changed.\n\nYeah, I was thinking to add in tempest side but I think devstack var will be easy and more close configuration if DEFAULT_IMAGE_FILE_NAME is overriden.\n\nand we can default IMG_FILE_TYPE to \u0027cirros\u0027 and in below block we can set it to \u0027vmware\u0027 where we know image is vmware one.\n\nhttps://github.com/openstack/devstack/blob/4dfb67a831686279acd66f65e51beba42f675c91/stackrc#L705\n\nalso, add a note in IMG_FILE_TYPE var that if you are overriding DEFAULT_IMAGE_FILE_NAME to different image than cirros, then override IMG_FILE_TYPE also so that devstack can set the correct dhcp_client in Tempest.",
      "parentUuid": "e58a1450_5c7229cc",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2e663688_a221895e",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 22873
      },
      "writtenOn": "2023-05-18T06:19:08Z",
      "side": 1,
      "message": "hmm, if DEFAULT_IMAGE_NAME or DEFAULT_IMAGE_FILE_NAME aren\u0027t set we\u0027ll default to cirros, right?\n\nhttps://github.com/openstack/devstack/blob/4dfb67a831686279acd66f65e51beba42f675c91/stackrc#L703-L704\n\nCan we then make that assumption to set IMAGE_FILE_TYPE to vmware?",
      "parentUuid": "e0a48556_77a835d0",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3e8ac06_b542626e",
        "filename": "lib/tempest",
        "patchSetId": 1
      },
      "lineNbr": 527,
      "author": {
        "id": 8556
      },
      "writtenOn": "2023-05-18T17:24:18Z",
      "side": 1,
      "message": "ah you are right. it still download the cirros image. We can always set IMAGE_FILE_TYPE to cirros.",
      "parentUuid": "2e663688_a221895e",
      "revId": "b783df4f5eb72fc009f57fc5341f3e686b10216d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    }
  ]
}