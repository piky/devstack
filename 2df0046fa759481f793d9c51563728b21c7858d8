{
  "comments": [
    {
      "key": {
        "uuid": "baada198_59c5ed08",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 7118
      },
      "writtenOn": "2014-07-16T04:23:13Z",
      "side": 1,
      "message": "this seem fragile; let\u0027s just use \"service httpd restart\" and let the init scripts do the right thing.   rhel/fedora service files already seem to have some logic in them for graceful restart \u0026 timeout",
      "revId": "2df0046fa759481f793d9c51563728b21c7858d8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "baada198_e46538e3",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 2903
      },
      "writtenOn": "2014-07-16T04:54:58Z",
      "side": 1,
      "message": "The issue is that restart via either init scripts or apachectl, etc is fragile. The init scripts often do the wrong things. I\u0027ve seen this across many distributions (fedora included), it is more prevalent in cases where you are running applications under the direction of Apache.\n\nThe real issue is that as soon as the \"stop\" finishes the \"start\" is tried via the init scripts (or apachectl, etc) and the port is still in use, this causes the start to fail.\n\nThis issue isn\u0027t extremely common, but when you have as many devstacks start up as we do in a given day, it doesn\u0027t take much to start showing up.\n\nI\u0027m happy to expand this comment if that would make it more clear.",
      "parentUuid": "baada198_59c5ed08",
      "revId": "2df0046fa759481f793d9c51563728b21c7858d8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "baada198_a480a0f8",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 2903
      },
      "writtenOn": "2014-07-16T05:07:47Z",
      "side": 1,
      "message": "A sleep 1 or 2 might be sufficient to catch 95+% of the cases this is actually hit.",
      "revId": "2df0046fa759481f793d9c51563728b21c7858d8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "baada198_a4aee07f",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 7118
      },
      "writtenOn": "2014-07-16T05:16:00Z",
      "side": 1,
      "message": "If \"service httpd restart\" isn\u0027t restarting properly, then it\u0027s broken and a serious upstream bug.  What\u0027s the point of restart if it doesn\u0027t work?  :)\n\nI can\u0027t replicate this (although all I did was a loop for a while on a small rhel vm) but if this is seen on Fedora/RHEL/CentOS I will volunteer to file a bug and chase it up.  I couldn\u0027t see any linked failures in the attached bug but i\u0027m happy to have details\n\nI would only like to see this as a workaround for a specific known broken platform (gate by if is_[fedora|ubunut|etc]) and with a comment pointing to the upstream bug of why it doesn\u0027t work",
      "parentUuid": "baada198_a480a0f8",
      "revId": "2df0046fa759481f793d9c51563728b21c7858d8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "baada198_f4479175",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 2903
      },
      "writtenOn": "2014-07-16T13:52:16Z",
      "side": 1,
      "message": "This is a long standing issue and isn\u0027t really a *serious* upstream bug. It affects a minority of cases. And most operational software (cms, etc) have worked around this by ensuring apache starts even if a restart fails. Sometimes a rapid stop (which most init scripts will claim has completed) will immediately issue a start, which if a resource (in this case the port) hasn\u0027t been freed completely, the start fails even thought anyone inspecting the system would be confused as to why.\n\nHere is an example of the error case:\n\nhttp://logs.openstack.org/25/102425/5/check/check-devstack-dsvm-cells/9991da4/logs/devstacklog.txt.gz#_2014-07-13_00_50_53_921\n\nNothing has changed in the restart case but if you look at the next set of tempest runs after the recheck against the bug this fixes, everything passes. https://review.openstack.org/#/c/102425/\n\nThis is a fairly uncommon edge case, but uncommon edge cases occur and cause noticeable failures for us just strictly due to volume. It takes one slow VM to release the resources and we\u0027ll see an occasional check or gate failure.\n\nThis issue has been documented in the apache wiki, though it appears apachectl restart avoids this issue (according to the wiki).\n\nI\u0027ll circle back later and change the apache restart from *init* to apachectl which should also resolve the issue without requiring an explicit sleep (as documented in the apache httpd wiki): https://wiki.apache.org/httpd/CouldNotBindToAddress (the message is slightly different due to newer versions of apache). Init scripts don\u0027t just wrap `apachectl restart`, they do a stop/start.",
      "parentUuid": "baada198_a4aee07f",
      "revId": "2df0046fa759481f793d9c51563728b21c7858d8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "baada198_e6536437",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 2903
      },
      "writtenOn": "2014-07-16T15:36:21Z",
      "side": 1,
      "message": "By later, i mean in the next patch I\u0027ll update it.",
      "parentUuid": "baada198_f4479175",
      "revId": "2df0046fa759481f793d9c51563728b21c7858d8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "baada198_e6527267",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 7118
      },
      "writtenOn": "2014-07-17T00:15:56Z",
      "side": 1,
      "message": "Please leave \"is_fedora\" using the system init scripts.  rhel seems to have a 10-second timeout before issuing a sigkill, and systemd should be watching the process.  If these aren\u0027t working we want to know\n\nIf this is a workaround for ubuntu, OK -- but it should be tagged with a comment to an upstream bug.",
      "parentUuid": "baada198_f4479175",
      "revId": "2df0046fa759481f793d9c51563728b21c7858d8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    }
  ]
}