# lib/multipath
# configure multipath

# Dependencies:
# packages - multipath-tools

# stack.sh
# ---------
# configure_multipath

# Save trace setting
XTRACE=$(set +o | grep xtrace)
set +o xtrace

MULTIPATH_CONF_DIR=/etc
MULTIPATH_CONF=$MULTIPATH_CONF_DIR/multipath.conf


# configure multipath
function configure_multipath() {
  TEMPFILE=`mktemp`

cat >$TEMPFILE <<EOF
blacklist {
     devnode "sda"
     devnode "vda"
     devnode "vdb"
}

defaults {
    user_friendly_names yes
}
EOF

  chmod 0440 $TEMPFILE
  sudo chown root:root $TEMPFILE
  sudo mv $TEMPFILE $MULTIPATH_CONF  
}

function test_multipath() {
  sudo cat $MULTIPATH_CONF
  sudo multipath -v 3
}
