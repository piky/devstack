#!/bin/bash
#
# lib/cinder_backends/storwize
# Configure the storwize driver

# Enable with:
#
#   CINDER_ENABLED_BACKENDS+=,storwize:<volume-type-name>

# Dependencies:
#
# - ``functions`` file
# - ``cinder`` configurations

# CINDER_CONF

# configure_cinder_driver - make configuration changes, including those to other services

# Save trace setting
MY_XTRACE=$(set +o | grep xtrace)
set +o xtrace


# Entry Points
# ------------

# configure_cinder_backend_storwize - Set config files, create data dirs, etc
function configure_cinder_backend_storwize {
    # To use storwize, set the following in local.conf:
    # CINDER_ENABLED_BACKENDS+=,storwize:<volume-type-name>
    # SAN_IP=<mvip>
    # SAN_LOGIN=<cluster-admin-account>
    # SAN_PASSWORD=<cluster-admin-password>
    # STORWIZE_SVC_VOLPOOL_NAME=<storwize-storage-pool-name>

    local be_name=$1
    iniset $CINDER_CONF $be_name volume_backend_name $be_name
    iniset $CINDER_CONF $be_name volume_driver "cinder.volume.drivers.ibm.storwize_svc.StorwizeSVCDriver"
    iniset $CINDER_CONF $be_name san_ip $SAN_IP
    iniset $CINDER_CONF $be_name san_login $SAN_LOGIN
    iniset $CINDER_CONF $be_name san_password $SAN_PASSWORD
    iniset $CINDER_CONF $be_name storwize_svc_volpool_name $STORWIZE_SVC_VOLPOOL_NAME
}


# Restore xtrace
$MY_XTRACE

# Local variables:
# mode: shell-script
# End:
