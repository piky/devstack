# lib/nova_plugins/hypervisor-fake
# Configure the Fake hypervisor

# Enable with:
# VIRT_DRIVER=fake

# Save trace setting
MY_XTRACE=$(set +o | grep xtrace)
set +o xtrace

# Defaults
# --------

NUMBER_FAKE_NOVA_COMPUTE=${NUMBER_FAKE_NOVA_COMPUTE:-1}


# Entry Points
# ------------

# configure_nova_hypervisor() - Set config files, create data dirs, etc
function configure_nova_hypervisor() {
    echo_summary "Using fake Virt driver"
    iniset $NOVA_CONF DEFAULT compute_driver "nova.virt.fake.FakeDriver"

    # Disable arbitrary limits
    iniset $NOVA_CONF DEFAULT quota_instances -1
    iniset $NOVA_CONF DEFAULT quota_cores -1
    iniset $NOVA_CONF DEFAULT quota_ram -1
    iniset $NOVA_CONF DEFAULT quota_floating_ips -1
    iniset $NOVA_CONF DEFAULT quota_fixed_ips -1
    iniset $NOVA_CONF DEFAULT quota_metadata_items -1
    iniset $NOVA_CONF DEFAULT quota_injected_files -1
    iniset $NOVA_CONF DEFAULT quota_injected_file_path_bytes -1
    iniset $NOVA_CONF DEFAULT quota_security_groups -1
    iniset $NOVA_CONF DEFAULT quota_security_group_rules -1
    iniset $NOVA_CONF DEFAULT quota_key_pairs -1
    iniset $NOVA_CONF DEFAULT scheduler_default_filters "RetryFilter,AvailabilityZoneFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter"
}


# Restore xtrace
$MY_XTRACE

# Local variables:
# mode: shell-script
# End:
