# lib/nova_plugins/hypervisor-xenserver
# Configure the XenServer hypervisor

# Enable with:
# VIRT_DRIVER=xenserver

# Save trace setting
MY_XTRACE=$(set +o | grep xtrace)
set +o xtrace

# Defaults
# --------

XENAPI_USER=${XENAPI_USER:-"root"}

XEN_FIREWALL_DRIVER=${XEN_FIREWALL_DRIVER:-"nova.virt.firewall.IptablesFirewallDriver"}


# Entry Points
# ------------

# configure_nova_hypervisor() - Set config files, create data dirs, etc
function configure_nova_hypervisor() {
    echo_summary "Using XenServer virtualization driver"
    if [ -z "$XENAPI_CONNECTION_URL" ]; then
        die $LINENO "XENAPI_CONNECTION_URL is not specified"
    fi

    read_password XENAPI_PASSWORD "ENTER A PASSWORD TO USE FOR XEN."

    iniset $NOVA_CONF DEFAULT compute_driver "xenapi.XenAPIDriver"
    iniset $NOVA_CONF DEFAULT xenapi_connection_url "$XENAPI_CONNECTION_URL"
    iniset $NOVA_CONF DEFAULT xenapi_connection_username "$XENAPI_USER"
    iniset $NOVA_CONF DEFAULT xenapi_connection_password "$XENAPI_PASSWORD"
    iniset $NOVA_CONF DEFAULT flat_injected "False"

    # Need to avoid crash due to new firewall support
    iniset $NOVA_CONF DEFAULT firewall_driver "$XEN_FIREWALL_DRIVER"
}


# Restore xtrace
$MY_XTRACE

# Local variables:
# mode: shell-script
# End:
