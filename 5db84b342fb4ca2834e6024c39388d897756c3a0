{
  "comments": [
    {
      "key": {
        "uuid": "d757bed0_d6f8e8b8",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 7118
      },
      "writtenOn": "2021-09-28T06:37:16Z",
      "side": 1,
      "message": "This exapnds to\n\n ProxyPass \"/placement\" \"unix:/var/run/uwsgi/placement-api.socket|uwsgi://uwsgi-uds-placement-api\" retry\u003d0 \n\non the host.  So per discussion in #openstack-qa, https://httpd.apache.org/docs/trunk/mod/mod_proxy.html#proxypass says\n\n\"If the first argument ends with a trailing /, the second argument should also end with a trailing /, and vice versa. Otherwise, the resulting requests to the backend may miss some needed slashes and do not deliver the expected results.\"\n\nSo it seems we either need to do this, and should probably strip any trailing slashes from ${url} for good measure -- or do the opposite; keep the trailing ${name}/ and ensure ${url} has a trailing slash.\n\nNot sure which is better?",
      "revId": "5db84b342fb4ca2834e6024c39388d897756c3a0",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "65b3fb18_c1d7aae4",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 7118
      },
      "writtenOn": "2021-09-28T07:13:15Z",
      "side": 1,
      "message": "To flesh this out, I\u0027ve tried with both\n\n ProxyPass \"/placement/\" \"unix:/var/run/uwsgi/placement-api.socket|uwsgi://uwsgi-uds-placement-api/\" retry\u003d0 \n\nand\n\n ProxyPass \"/placement\" \"unix:/var/run/uwsgi/placement-api.socket|uwsgi://uwsgi-uds-placement-api\" retry\u003d0 \n\nand both appear to work with the latest Apache (104.130.219.63 is the held node where I was playing with this; feel free to poke).\n\nI\u0027m not sure which is the better format to enforce here?  Flip a coin?",
      "parentUuid": "d757bed0_d6f8e8b8",
      "revId": "5db84b342fb4ca2834e6024c39388d897756c3a0",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4bc88e77_c74ad335",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 9708
      },
      "writtenOn": "2021-09-28T07:29:56Z",
      "side": 1,
      "message": "I think we need to use the \u0027/placement\u0027 variant to allow GET http://\u003cip\u003e/placement to be routed to the placement app. As far as I see if we use \u0027/placement/\u0027 variant then GET \u003cip\u003e/placement is not routed and that would be a breaking API change.",
      "parentUuid": "65b3fb18_c1d7aae4",
      "revId": "5db84b342fb4ca2834e6024c39388d897756c3a0",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "328115ad_410dbcf0",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 7166
      },
      "writtenOn": "2021-09-28T07:35:46Z",
      "side": 1,
      "message": "Agreed with Gibi, the endpoint should not have a trailed slash for getting the WSGI app.",
      "parentUuid": "4bc88e77_c74ad335",
      "revId": "5db84b342fb4ca2834e6024c39388d897756c3a0",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c1eb13d8_5c3c1abc",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 30491
      },
      "writtenOn": "2021-09-28T07:48:42Z",
      "side": 1,
      "message": "We can add a redirect from /placement to /placement/ but I\u0027m not sure about that being a breaking change. The API is defined starting with /, /placement is just a prefix to that so the contract is still valid.",
      "parentUuid": "328115ad_410dbcf0",
      "revId": "5db84b342fb4ca2834e6024c39388d897756c3a0",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0304511_405bbef4",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 9708
      },
      "writtenOn": "2021-09-28T08:23:38Z",
      "side": 1,
      "message": "Hm, now I looked at it from the perspective how nova works. Right now both \nhttp://\u003cip\u003e/compute and http://\u003c\u003e/compute/ is routed to the app and result in the version document returned. \n\nAlso I\u0027ve checked and placement before the Apache change worked the same way as nova. \n\nI withdraw my argument about API correctness as you are right Radoslaw, we are defining our API as simply starting with \u0027/\u0027 so based on that \u0027any-prefix/\u0027 is correct but \u0027any-prefix\u0027 is not correct.  Still I\u0027m wondering if want to start rejecting \u0027any-prefix\u0027 now, and for placement only.",
      "parentUuid": "c1eb13d8_5c3c1abc",
      "revId": "5db84b342fb4ca2834e6024c39388d897756c3a0",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e910bb08_1e92193b",
        "filename": "lib/apache",
        "patchSetId": 1
      },
      "lineNbr": 306,
      "author": {
        "id": 7118
      },
      "writtenOn": "2021-09-28T10:01:15Z",
      "side": 1,
      "message": "Does somebody want to propose a final change?  Personally I think the / variant because it seems sane and matches [1].  IMO we should either reject a ${url} without a trailing slash or just add one if missing.\n\n[1] https://uwsgi-docs.readthedocs.io/en/latest/Apache.html#mod-proxy-uwsgi",
      "parentUuid": "c1eb13d8_5c3c1abc",
      "revId": "5db84b342fb4ca2834e6024c39388d897756c3a0",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    }
  ]
}